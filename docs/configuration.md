# Configuration

POSMID provides extensive configuration options to customize the application behavior, security settings, and feature toggles. This guide covers all configuration files and environment variables.

## Environment Variables

### Application Configuration

| Variable | Type | Default | Description |
|----------|------|---------|-------------|
| `APP_NAME` | string | "POSMID" | Application display name |
| `APP_ENV` | string | local | Environment (local, staging, production) |
| `APP_KEY` | string | (required) | Laravel application key (generated by `php artisan key:generate`) |
| `APP_DEBUG` | boolean | false | Enable debug mode |
| `APP_TIMEZONE` | string | UTC | Application timezone (e.g., "Asia/Jakarta") |
| `APP_URL` | string | http://localhost | Base application URL |
| `APP_LOCALE` | string | en | Default application locale |
| `APP_FALLBACK_LOCALE` | string | en | Fallback locale |
| `APP_MAINTENANCE_DRIVER` | string | file | Maintenance mode driver (file, cache) |

### Database Configuration

#### Main Database
```env
DB_CONNECTION=pgsql
DB_HOST=127.0.0.1
DB_PORT=5432
DB_DATABASE=posmid
DB_USERNAME=your_username
DB_PASSWORD=your_password
DB_SCHEMA=public
DB_SSL_MODE=prefer
```

#### Tenant Database (Multi-tenancy)
```env
DB_TENANT_CONNECTION=pgsql
DB_TENANT_HOST=127.0.0.1
DB_TENANT_PORT=5432
DB_TENANT_DATABASE=posmid_tenant
DB_TENANT_USERNAME=your_username
DB_TENANT_PASSWORD=your_password
DB_TENANT_SCHEMA=tenant
```

**Database Parameters:**

| Variable | Type | Default | Description |
|----------|------|---------|-------------|
| `DB_CONNECTION` | string | pgsql | Database driver (pgsql, mysql, sqlite) |
| `DB_HOST` | string | 127.0.0.1 | Database host |
| `DB_PORT` | string | 5432 | Database port |
| `DB_DATABASE` | string | posmid | Database name |
| `DB_USERNAME` | string | - | Database username |
| `DB_PASSWORD` | string | - | Database password |
| `DB_SCHEMA` | string | public | Default schema (PostgreSQL) |
| `DB_SSL_MODE` | string | prefer | SSL mode (PostgreSQL) |

### Cache Configuration

```env
CACHE_STORE=database
CACHE_PREFIX=posmid
CACHE_DEFAULT_TTL=3600
```

| Variable | Type | Default | Description |
|----------|------|---------|-------------|
| `CACHE_STORE` | string | database | Cache driver (file, database, redis, memcached) |
| `CACHE_PREFIX` | string | posmid | Cache key prefix |
| `CACHE_DEFAULT_TTL` | integer | 3600 | Default cache TTL in seconds |

### Session Configuration

```env
SESSION_DRIVER=database
SESSION_LIFETIME=120
SESSION_ENCRYPT=false
SESSION_PATH=/
SESSION_DOMAIN=null
SESSION_SECURE_COOKIE=false
SESSION_SAME_SITE=lax
```

### Authentication & Authorization

#### Sanctum (API Authentication)
```env
SANCTUM_STATEFUL_DOMAINS=localhost,127.0.0.1,::1
SANCTUM_GUARD=web
SANCTUM_EXPIRATION=525600
SANCTUM_TOKEN_PREFIX=Bearer
```

| Variable | Type | Default | Description |
|----------|------|---------|-------------|
| `SANCTUM_STATEFUL_DOMAINS` | string | localhost,127.0.0.1 | Domains for stateful authentication |
| `SANCTUM_GUARD` | string | web | Default guard for Sanctum |
| `SANCTUM_EXPIRATION` | integer | 525600 | Token expiration in minutes (1 year) |
| `SANCTUM_TOKEN_PREFIX` | string | Bearer | Token prefix in Authorization header |

#### Permission Configuration
```env
PERMISSION_CACHE_TTL=3600
PERMISSION_CACHE_MODEL=1
```

### OpenAPI Configuration

```env
OPENAPI_SPEC_PATH=openapi.yaml
OPENAPI_VALIDATE_REQUEST=true
OPENAPI_VALIDATE_RESPONSE=true
OPENAPI_BASE_URL=http://localhost:9000
OPENAPI_VERSION=3.0.0
```

**OpenAPI Parameters:**

| Variable | Type | Default | Description |
|----------|------|---------|-------------|
| `OPENAPI_SPEC_PATH` | string | openapi.yaml | Path to OpenAPI specification file |
| `OPENAPI_VALIDATE_REQUEST` | boolean | true | Validate incoming requests against spec |
| `OPENAPI_VALIDATE_RESPONSE` | boolean | true | Validate outgoing responses against spec |
| `OPENAPI_BASE_URL` | string | http://localhost:9000 | Base URL for OpenAPI server |
| `OPENAPI_VERSION` | string | 3.0.0 | OpenAPI specification version |

### Email Configuration

```env
MAIL_MAILER=smtp
MAIL_HOST=mailhog
MAIL_PORT=1025
MAIL_USERNAME=null
MAIL_PASSWORD=null
MAIL_ENCRYPTION=null
MAIL_FROM_ADDRESS="hello@example.com"
MAIL_FROM_NAME="${APP_NAME}"
```

### Queue Configuration

```env
QUEUE_CONNECTION=database
QUEUE_FAILED_DRIVER=database
```

### Logging Configuration

```env
LOG_CHANNEL=stack
LOG_DEPRECATIONS_CHANNEL=null
LOG_LEVEL=debug
LOG_STACK=single
LOG_DAILY_DAYS=14
```

## Configuration Files

### Core Configuration Files

Located in `config/` directory:

- `app.php` - Application configuration
- `auth.php` - Authentication configuration
- `database.php` - Database connections
- `permission.php` - Permission system configuration
- `sanctum.php` - Sanctum authentication
- `view.php` - View rendering configuration

### Custom Configuration Files

#### OpenAPI Configuration (`config/openapi.php`)

```php
<?php

return [
    'spec_path' => env('OPENAPI_SPEC_PATH', 'openapi.yaml'),
    'validate_request' => env('OPENAPI_VALIDATE_REQUEST', true),
    'validate_response' => env('OPENAPI_VALIDATE_RESPONSE', true),
    'base_url' => env('OPENAPI_BASE_URL', 'http://localhost:9000'),
    'version' => env('OPENAPI_VERSION', '3.0.0'),

    // Middleware configuration
    'middleware' => [
        'validate_request' => true,
        'validate_response' => true,
        'throw_on_error' => env('APP_DEBUG', false),
    ],

    // Response validation
    'response_validation' => [
        'enabled' => env('OPENAPI_VALIDATE_RESPONSE', true),
        'exclude_status_codes' => [500, 502, 503, 504],
    ],
];
```

#### Multi-tenancy Configuration (`config/tenant.php`)

```php
<?php

return [
    'connection' => env('DB_TENANT_CONNECTION', 'pgsql'),
    'host' => env('DB_TENANT_HOST', '127.0.0.1'),
    'port' => env('DB_TENANT_PORT', '5432'),
    'database' => env('DB_TENANT_DATABASE', 'posmid_tenant'),
    'username' => env('DB_TENANT_USERNAME'),
    'password' => env('DB_TENANT_PASSWORD'),

    'schema' => env('DB_TENANT_SCHEMA', 'tenant'),
    'table_prefix' => env('DB_TENANT_PREFIX', 'tenant_'),

    // Tenant identification
    'identifier' => 'tenant_id',
    'domain_column' => 'domain',
    'uuid_column' => 'uuid',

    // Cache configuration
    'cache_ttl' => 3600,
];
```

#### POSMID Custom Configuration (`config/posmid.php`)

```php
<?php

return [
    'version' => '1.0.0',

    // Feature toggles
    'features' => [
        'multi_tenancy' => true,
        'inventory_management' => true,
        'order_management' => true,
        'customer_management' => true,
        'reporting' => true,
    ],

    // API configuration
    'api' => [
        'version' => 'v1',
        'prefix' => 'api',
        'middleware' => ['auth:sanctum'],
    ],

    // Frontend configuration
    'frontend' => [
        'dev_server_port' => 5173,
        'build_output' => 'dist',
        'assets_url' => '/assets',
    ],

    // Command configuration
    'commands' => [
        'run' => [
            'backend_port' => 8000,
            'frontend_dev' => true,
            'auto_open_browser' => false,
        ],
    ],
];
```

## Runtime Configuration

### Artisan Commands

#### Environment Check
```bash
php artisan env:check
```
Validates all environment variables and configuration.

#### Configuration Cache
```bash
# Clear config cache
php artisan config:clear

# Cache configuration for production
php artisan config:cache
```

#### Environment List
```bash
php artisan env:list
```
Displays all environment variables and their values.

### Dynamic Configuration

POSMID supports dynamic configuration updates through:

1. **Environment Variables** - Override any config value
2. **Runtime Config Updates** - Modify config at runtime
3. **Tenant-Specific Config** - Per-tenant configuration overrides

## Security Configuration

### CORS Configuration

Edit `config/cors.php`:

```php
<?php

return [
    'paths' => ['api/*'],
    'allowed_methods' => ['*'],
    'allowed_origins' => ['http://localhost:5173', 'http://localhost:3000'],
    'allowed_origins_patterns' => [],
    'allowed_headers' => ['*'],
    'exposed_headers' => [],
    'max_age' => 0,
    'supports_credentials' => true,
];
```

### Security Headers

POSMID includes security middleware. Configure in `config/security.php`:

```php
<?php

return [
    'headers' => [
        'X-Frame-Options' => 'SAMEORIGIN',
        'X-XSS-Protection' => '1; mode=block',
        'X-Content-Type-Options' => 'nosniff',
        'Referrer-Policy' => 'strict-origin-when-cross-origin',
        'Content-Security-Policy' => "default-src 'self'",
    ],

    'https_only' => env('APP_ENV') === 'production',
];
```

## Performance Configuration

### Caching

```env
CACHE_STORE=redis
REDIS_HOST=127.0.0.1
REDIS_PASSWORD=null
REDIS_PORT=6379
```

### Queue Optimization

```env
QUEUE_CONNECTION=redis
QUEUE_FAILED_DRIVER=database
QUEUE_MAX_JOBS=1000
QUEUE_MAX_TIME=90
```

### Database Optimization

```env
DB_CONNECTION_POOL_SIZE=10
DB_CONNECTION_MAX_IDLE_TIME=60
DB_CONNECTION_MAX_LIFETIME=3600
```

## Monitoring Configuration

### Logging

```env
LOG_CHANNEL=daily
LOG_LEVEL=info
LOG_DAILY_DAYS=30
```

### Health Checks

Configure health check endpoints in `routes/web.php`:

```php
Route::get('/health', function () {
    return response()->json([
        'status' => 'ok',
        'timestamp' => now(),
        'services' => [
            'database' => DB::connection()->getPdo() ? 'ok' : 'error',
            'cache' => Cache::store()->getStore() ? 'ok' : 'error',
        ]
    ]);
});
```

## Troubleshooting Configuration Issues

### Common Problems

1. **Configuration Cache Issues**
   ```bash
   php artisan config:clear
   php artisan cache:clear
   ```

2. **Environment Variables Not Loading**
   - Check `.env` file exists and is readable
   - Verify `APP_KEY` is set
   - Run `php artisan env:check`

3. **Database Connection Issues**
   ```bash
   php artisan tinker
   DB::connection()->getPdo()
   ```

4. **Permission Issues**
   ```bash
   chmod 644 .env
   chown www-data:www-data .env
   ```

### Validation Commands

```bash
# Validate all configurations
php artisan posmid:validate-config

# Check environment setup
php artisan env:check

# Test database connections
php artisan db:monitor
```

## Best Practices

1. **Use Environment Variables** - Never commit secrets to version control
2. **Validate Configuration** - Always run validation after changes
3. **Cache in Production** - Use `config:cache` for performance
4. **Document Changes** - Update this documentation when adding new configs
5. **Test Configurations** - Validate configs in different environments

## Next Steps

- [Authentication](authentication.md) - User management configuration
- [API Reference](api.md) - API endpoints and OpenAPI configuration
- [Commands](commands.md) - Custom command configuration

---

[← Installation](installation.md) | [Authentication →](authentication.md)